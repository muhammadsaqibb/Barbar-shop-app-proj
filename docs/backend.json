{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the BookItEasy application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application (e.g., 'client', 'admin', 'staff').",
          "enum": ["client", "admin", "staff"]
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment booked by a client.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment entity."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Appointment)"
        },
        "service": {
          "type": "string",
          "description": "The service being booked for the appointment."
        },
        "date": {
          "type": "string",
          "description": "The date of the appointment.",
          "format": "date-time"
        },
        "time": {
          "type": "string",
          "description": "The time of the appointment."
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., 'pending', 'confirmed', 'cancelled')."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the appointment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clientId",
        "service",
        "date",
        "time",
        "status",
        "createdAt"
      ]
    },
     "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a service or package offered by the barber shop.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service."
        },
        "name": {
          "type": "string",
          "description": "The name of the service."
        },
        "isPackage": {
          "type": "boolean",
          "description": "True if this is a package deal."
        },
        "price": {
          "type": "number",
          "description": "The price of the service."
        },
        "duration": {
          "type": "number",
          "description": "The duration of the service in minutes."
        },
        "description": {
          "type": "string",
          "description": "A short description of the service."
        },
        "enabled": {
          "type": "boolean",
          "description": "Whether the service is available for booking."
        }
      },
      "required": ["id", "name", "isPackage", "price", "duration", "enabled"]
    },
    "Barber": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Barber",
        "type": "object",
        "description": "Represents a barber available for appointments.",
        "properties": {
            "id": {
                "type": "string",
                "description": "Unique identifier for the barber."
            },
            "name": {
                "type": "string",
                "description": "The name of the barber."
            }
        },
        "required": ["id", "name"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  The `userId` is the Firebase Auth UID. This collection stores basic user information like name, email, and role.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointments booked by each user. `clientId` in each appointment is equivalent to the `userId` in the path to maintain data integrity and simplify querying. Includes `clientId` for query purposes, though it mirrors the path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who booked the appointment (the client)."
            },
            {
              "name": "appointmentId",
              "description": "The unique ID of the appointment."
            }
          ]
        }
      },
       {
        "path": "/services/{serviceId}",
        "definition": {
          "entityName": "Service",
          "schema": { "$ref": "#/backend/entities/Service" },
          "description": "Stores all services and packages offered by the shop.",
          "params": [
            {
              "name": "serviceId",
              "description": "The unique ID of the service."
            }
          ]
        }
      },
      {
        "path": "/barbers/{barberId}",
        "definition": {
          "entityName": "Barber",
          "schema": { "$ref": "#/backend/entities/Barber" },
          "description": "Stores information about available barbers.",
          "params": [
            {
              "name": "barberId",
              "description": "The unique ID of the barber."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a simple appointment booking system with user authentication and role management. It prioritizes security and scalability by adhering to the principles of Authorization Independence and Structural Segregation. The structure uses path-based ownership for user-specific data (appointments) and separates user profiles from appointment data to simplify security rules and ensure data integrity. This design avoids using `get()` calls in security rules, enabling atomic operations and easier debugging. The `services` and `barbers` collections are top-level collections for easy querying and management by admins.\n\nAuthorization Independence:\nAppointments are stored under `/users/{userId}/appointments/{appointmentId}`, which allows direct ownership-based security rules without needing to fetch parent user data. The `clientId` field in the `Appointment` document is redundant but is kept to make querying for a specific client's appointments easier, if necessary, at the cost of data duplication.\n\nQAPs Support:\nThe structure supports QAPs (Rules are not Filters) effectively. List operations for appointments are scoped to the user's path (`/users/{userId}/appointments`), enabling secure listing of appointments associated with a specific user. The 'users' collection is segregated from the 'appointments' subcollection to ensure that listing users does not expose appointment data. Admins will require custom backend logic, the firestore structure is not aware of admin capabilities."
  }
}
